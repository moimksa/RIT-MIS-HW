<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings | DonorHub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/pages.css">
</head>
<body>
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo"><div class="logo-icon"><i class="fas fa-heart-pulse"></i></div><span class="logo-text">DonorHub</span></div>
            <button class="sidebar-toggle" id="sidebarToggle"><i class="fas fa-angles-left"></i></button>
        </div>
        <div class="nav-section">
            <span class="nav-section-title">Main</span>
            <ul class="nav-menu">
                <li class="nav-item"><a href="../index.html" class="nav-link"><i class="fas fa-grid-2"></i><span>Dashboard</span></a></li>
                <li class="nav-item"><a href="donors.html" class="nav-link"><i class="fas fa-users"></i><span>Donors</span></a></li>
                <li class="nav-item"><a href="donations.html" class="nav-link"><i class="fas fa-hand-holding-heart"></i><span>Donations</span></a></li>
                <li class="nav-item"><a href="campaigns.html" class="nav-link"><i class="fas fa-bullhorn"></i><span>Campaigns</span></a></li>
            </ul>
        </div>
        <div class="nav-section">
            <span class="nav-section-title">System</span>
            <ul class="nav-menu">
                <li class="nav-item active"><a href="settings.html" class="nav-link"><i class="fas fa-gear"></i><span>Settings</span></a></li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <header class="header">
            <div class="header-left">
                <button class="mobile-menu-btn" id="mobileMenuBtn"><i class="fas fa-bars"></i></button>
                <div class="page-title"><h1>Settings</h1><p class="page-subtitle">Configure Oracle APEX Connection</p></div>
            </div>
        </header>

        <div class="page-content">
            <div class="card" style="max-width:800px;">
                <div class="card-header"><h2 class="card-title">Oracle APEX Configuration</h2></div>
                <div class="card-body">
                    <div class="alert alert-warning" style="margin-bottom:1.5rem;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div><strong>Demo Mode Active</strong><br>Configure your Oracle APEX connection below to use live data.</div>
                    </div>

                    <form id="apexConfigForm">
                        <div class="form-group">
                            <label>APEX Base URL *</label>
                            <input type="url" id="apexBaseUrl" placeholder="https://apex.oracle.com/pls/apex/your_workspace">
                            <small style="color:var(--neutral-500);">Your Oracle APEX ORDS URL</small>
                        </div>
                        <div class="form-group">
                            <label>API Path</label>
                            <input type="text" id="apiPath" value="/api/v1">
                        </div>
                        <div class="form-group">
                            <label>Authentication</label>
                            <select id="authType">
                                <option value="none">No Authentication</option>
                                <option value="oauth2">OAuth 2.0</option>
                            </select>
                        </div>
                        <div id="oauth2Fields" style="display:none;">
                            <div class="form-group"><label>Client ID</label><input type="text" id="clientId"></div>
                            <div class="form-group"><label>Client Secret</label><input type="password" id="clientSecret"></div>
                            <div class="form-group"><label>Token URL</label><input type="url" id="tokenUrl"></div>
                        </div>
                        <div style="display:flex;gap:1rem;margin-top:1.5rem;">
                            <button type="button" class="btn btn-outline" onclick="testConnection()"><i class="fas fa-plug"></i> Test</button>
                            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card" style="max-width:800px;margin-top:1.5rem;">
                <div class="card-header"><h2 class="card-title">Required API Endpoints</h2></div>
                <div class="card-body">
                    <p style="margin-bottom:1rem;color:var(--neutral-600);">Create these REST endpoints in Oracle APEX:</p>
                    <div class="code-block"><pre>GET /api/v1/dashboard        → v_api_financial_dashboard
GET /api/v1/donors           → v_api_donors  
GET /api/v1/donations        → v_api_donations
GET /api/v1/donations/recent → Latest donations
GET /api/v1/campaigns        → v_api_campaigns
GET /api/v1/campaigns/progress → v_campaign_progress
GET /api/v1/donors/top       → Top donors by total</pre></div>
                </div>
            </div>
        </div>
    </main>

    <div class="connection-status" id="connectionStatus"><i class="fas fa-circle"></i><span>Demo Mode</span></div>

    <script src="../js/config.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/main.js"></script>
    <script>
        document.getElementById('authType').addEventListener('change', function() {
            document.getElementById('oauth2Fields').style.display = this.value === 'oauth2' ? 'block' : 'none';
        });
        
        async function testConnection() {
            const url = document.getElementById('apexBaseUrl').value;
            if (!url) { showToast('Enter APEX URL first', 'warning'); return; }
            showToast('Testing...', 'info');
            try {
                const r = await fetch(url + '/api/v1/dashboard');
                showToast(r.ok ? 'Connected!' : 'Failed: ' + r.status, r.ok ? 'success' : 'error');
            } catch(e) { showToast('Error: ' + e.message, 'error'); }
        }
        
        document.getElementById('apexConfigForm').addEventListener('submit', function(e) {
            e.preventDefault();
            localStorage.setItem('donorHubConfig', JSON.stringify({
                baseUrl: document.getElementById('apexBaseUrl').value,
                apiPath: document.getElementById('apiPath').value,
                authType: document.getElementById('authType').value
            }));
            showToast('Saved! Refresh to apply.', 'success');
        });
        
        const saved = localStorage.getItem('donorHubConfig');
        if (saved) {
            const c = JSON.parse(saved);
            document.getElementById('apexBaseUrl').value = c.baseUrl || '';
            document.getElementById('apiPath').value = c.apiPath || '/api/v1';
        }
    </script>
</body>
</html>
