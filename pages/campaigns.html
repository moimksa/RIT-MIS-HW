<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaigns | DonorHub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/pages.css">
</head>
<body>
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon"><i class="fas fa-heart-pulse"></i></div>
                <span class="logo-text">DonorHub</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle"><i class="fas fa-angles-left"></i></button>
        </div>
        <div class="nav-section">
            <span class="nav-section-title">Main</span>
            <ul class="nav-menu">
                <li class="nav-item"><a href="../index.html" class="nav-link"><i class="fas fa-grid-2"></i><span>Dashboard</span></a></li>
                <li class="nav-item"><a href="donors.html" class="nav-link"><i class="fas fa-users"></i><span>Donors</span></a></li>
                <li class="nav-item"><a href="donations.html" class="nav-link"><i class="fas fa-hand-holding-heart"></i><span>Donations</span></a></li>
                <li class="nav-item active"><a href="campaigns.html" class="nav-link"><i class="fas fa-bullhorn"></i><span>Campaigns</span></a></li>
            </ul>
        </div>
        <div class="nav-section">
            <span class="nav-section-title">Finance</span>
            <ul class="nav-menu">
                <li class="nav-item"><a href="revenue.html" class="nav-link"><i class="fas fa-arrow-trend-up"></i><span>Revenue</span></a></li>
                <li class="nav-item"><a href="expenses.html" class="nav-link"><i class="fas fa-arrow-trend-down"></i><span>Expenses</span></a></li>
                <li class="nav-item"><a href="reports.html" class="nav-link"><i class="fas fa-chart-pie"></i><span>Reports</span></a></li>
            </ul>
        </div>
        <div class="nav-section">
            <span class="nav-section-title">Inventory</span>
            <ul class="nav-menu">
                <li class="nav-item"><a href="inventory.html" class="nav-link"><i class="fas fa-boxes-stacked"></i><span>Products</span></a></li>
            </ul>
        </div>
        <div class="nav-section">
            <span class="nav-section-title">System</span>
            <ul class="nav-menu">
                <li class="nav-item"><a href="settings.html" class="nav-link"><i class="fas fa-gear"></i><span>Settings</span></a></li>
            </ul>
        </div>
        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar"><i class="fas fa-user"></i></div>
                <div class="user-details">
                    <span class="user-name">Admin User</span>
                    <span class="user-role">Administrator</span>
                </div>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <header class="header">
            <div class="header-left">
                <button class="mobile-menu-btn" id="mobileMenuBtn"><i class="fas fa-bars"></i></button>
                <div class="page-title">
                    <h1>Campaigns</h1>
                    <p class="page-subtitle">Manage fundraising campaigns</p>
                </div>
            </div>
            <div class="header-right">
                <button class="btn btn-primary" onclick="openModal('newCampaignModal')">
                    <i class="fas fa-plus"></i>
                    <span>New Campaign</span>
                </button>
            </div>
        </header>

        <div class="page-content">
            <!-- Stats Summary -->
            <div class="stats-summary">
                <div class="stat-item">
                    <div class="stat-value" id="activeCampaigns">0</div>
                    <div class="stat-label">Active Campaigns</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalRaised">$0</div>
                    <div class="stat-label">Total Raised</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalGoal">$0</div>
                    <div class="stat-label">Total Goal</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="avgProgress">0%</div>
                    <div class="stat-label">Avg. Progress</div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters-bar">
                <div class="filter-group">
                    <label>Status</label>
                    <select id="filterStatus">
                        <option value="">All Status</option>
                        <option value="ACTIVE">Active</option>
                        <option value="PLANNED">Planned</option>
                        <option value="COMPLETED">Completed</option>
                        <option value="PAUSED">Paused</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Sort By</label>
                    <select id="sortBy">
                        <option value="date">Start Date</option>
                        <option value="progress">Progress</option>
                        <option value="amount">Amount Raised</option>
                    </select>
                </div>
            </div>

            <!-- Campaigns Grid -->
            <div class="campaigns-grid" id="campaignsGrid">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </main>

    <!-- New Campaign Modal -->
    <div class="modal-overlay" id="newCampaignModal">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h3>Create New Campaign</h3>
                <button class="modal-close" onclick="closeModal('newCampaignModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="newCampaignForm">
                    <div class="form-section">
                        <h4 class="form-section-title">Campaign Details</h4>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="campaignName">Campaign Name *</label>
                                <input type="text" id="campaignName" name="campaign_name" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="campaignCode">Campaign Code *</label>
                                <input type="text" id="campaignCode" name="campaign_code" required placeholder="e.g., SPRING2024">
                            </div>
                            <div class="form-group">
                                <label for="campaignType">Campaign Type</label>
                                <select id="campaignType" name="campaign_type">
                                    <option value="ANNUAL">Annual</option>
                                    <option value="CAPITAL">Capital</option>
                                    <option value="EMERGENCY">Emergency</option>
                                    <option value="PROJECT">Project-based</option>
                                    <option value="EVENT">Event</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="campaignDesc">Description</label>
                                <textarea id="campaignDesc" name="description" rows="3"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4 class="form-section-title">Goals & Timeline</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="goalAmount">Goal Amount *</label>
                                <input type="number" id="goalAmount" name="goal_amount" step="0.01" min="1" required>
                            </div>
                            <div class="form-group">
                                <label for="minDonation">Minimum Donation</label>
                                <input type="number" id="minDonation" name="minimum_donation" step="0.01" value="1">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="startDate">Start Date *</label>
                                <input type="date" id="startDate" name="start_date" required>
                            </div>
                            <div class="form-group">
                                <label for="endDate">End Date</label>
                                <input type="date" id="endDate" name="end_date">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('newCampaignModal')">Cancel</button>
                <button type="submit" form="newCampaignForm" class="btn btn-primary">
                    <i class="fas fa-save"></i> Create Campaign
                </button>
            </div>
        </div>
    </div>

    <div class="connection-status" id="connectionStatus">
        <i class="fas fa-circle"></i>
        <span>Checking connection...</span>
    </div>

    <script src="../js/config.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadCampaigns();
        });

        async function loadCampaigns() {
            try {
                const response = await api.getCampaignProgress();
                const campaigns = response.items || [];

                // Update stats
                const active = campaigns.filter(c => c.status === 'ACTIVE').length;
                const totalRaised = campaigns.reduce((sum, c) => sum + (c.raised_amount || 0), 0);
                const totalGoal = campaigns.reduce((sum, c) => sum + (c.goal_amount || 0), 0);
                const avgProgress = campaigns.length > 0 ? campaigns.reduce((sum, c) => sum + (c.progress_percent || 0), 0) / campaigns.length : 0;

                document.getElementById('activeCampaigns').textContent = active;
                document.getElementById('totalRaised').textContent = formatCurrency(totalRaised);
                document.getElementById('totalGoal').textContent = formatCurrency(totalGoal);
                document.getElementById('avgProgress').textContent = avgProgress.toFixed(1) + '%';

                renderCampaigns(campaigns);
            } catch (error) {
                console.error('Error loading campaigns:', error);
            }
        }

        function renderCampaigns(campaigns) {
            const grid = document.getElementById('campaignsGrid');
            
            if (campaigns.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-state-icon"><i class="fas fa-bullhorn"></i></div>
                        <h3>No campaigns yet</h3>
                        <p>Create your first campaign to start fundraising</p>
                        <button class="btn btn-primary" onclick="openModal('newCampaignModal')">
                            <i class="fas fa-plus"></i> Create Campaign
                        </button>
                    </div>
                `;
                return;
            }

            grid.innerHTML = campaigns.map(c => `
                <div class="campaign-card">
                    <div class="campaign-card-header">
                        <div>
                            <div class="campaign-card-title">${c.campaign_name}</div>
                            <div class="campaign-card-dates">
                                ${c.start_date ? formatDate(c.start_date) : 'No start date'} - ${c.end_date ? formatDate(c.end_date) : 'Ongoing'}
                            </div>
                        </div>
                        ${renderStatusBadge(c.status)}
                    </div>
                    
                    <div class="campaign-card-stats">
                        <div class="campaign-stat">
                            <div class="campaign-stat-value">${formatCurrency(c.raised_amount)}</div>
                            <div class="campaign-stat-label">Raised</div>
                        </div>
                        <div class="campaign-stat">
                            <div class="campaign-stat-value">${c.donor_count}</div>
                            <div class="campaign-stat-label">Donors</div>
                        </div>
                    </div>

                    <div class="campaign-card-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(c.progress_percent, 100)}%"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.8rem; color: var(--neutral-500);">
                            <span>${c.progress_percent.toFixed(1)}% of goal</span>
                            <span>Goal: ${formatCurrency(c.goal_amount)}</span>
                        </div>
                    </div>

                    <div class="campaign-card-footer">
                        <button class="btn btn-sm btn-outline">View Details</button>
                        <button class="btn btn-sm btn-primary">Record Donation</button>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
